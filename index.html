<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLU BARCODE GENERATOR</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/ods.js"></script>
</head>
<body>
    <div id="menu-container"></div>

    <div class="container">
        <div class="header">
            <h1>PLU BARCODE GENERATOR</h1>
            <h1>VERSI STAND ALONE</h1>
            <h1>BY BDK234</h1>
            <div class="donation-info">
                <br>
                WARNING!!!!!! <br>
                saya bisa memblok penggunaan ini kapan saja. jadi tolong hargai!!
            </div>
        </div>

        <div class="data-status loading no-print" id="dataStatus" style="display: none;">
        </div>

        <div class="input-group no-print">
            <div>Input PLU (satu atau lebih):</div>
            <div class="search-container">
                <textarea id="searchInput" placeholder="Masukkan kode PLU...&#10;Satu PLU per baris" disabled></textarea>
            </div>
            <div>
                <button onclick="searchMultiplePLU()" id="searchBtn" disabled>Cari Semua</button>
                <button onclick="clearResults()">Bersihkan Hasil</button>
                <button onclick="window.print()">Cetak Semua</button>
                <button onclick="loadExcelData()" id="reloadBtn">üîÑ Reload Data</button>
            </div>
        </div>

        <div id="result"></div>

        <!-- Kontrol slideshow dipindahkan ke bawah kontainer barcode -->
        <div class="slideshow-controls no-print" id="slideshowControls">
            <div class="slide-info" id="slideInfo">PLU 1 dari 1</div>
            <div>
                <button onclick="toggleSlideshow()" id="slideshowBtn">Mulai Slideshow</button>
                <button onclick="prevSlide()">‚Üê Sebelumnya</button>
                <button onclick="nextSlide()">Selanjutnya ‚Üí</button>
            </div>
            <div class="time-selector">
                <label>Waktu per slide:</label>
                <select id="slideTime" onchange="updateSlideTime()">
                    <option value="1000">1 detik</option>
                    <option value="2000" selected>2 detik</option>
                    <option value="3000">3 detik</option>
                    <option value="4000">4 detik</option>
                    <option value="5000">5 detik</option>
                </select>
            </div>
            <div class="animation-selector">
                <label>Animasi:</label>
                <select id="animationType" onchange="updateAnimationType()">
                    <option value="slide" selected>Slide (Geser)</option>
                    <option value="fade">Fade (Memudar)</option>
                </select>
            </div>
        </div>
    </div>
    
    <div id="footer-container"></div>

    <script src="menu.js"></script>
    <script src="footer.js"></script>

    <script>
        let excelData = [];
        let slideshowInterval = null;
        let currentSlide = 0;
        let slides = [];
        let slideTime = 2000;
        let isSlideshow = false;
        let animationType = 'slide';
        let isAnimating = false;

        // Touch/Swipe variables
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        let isDragging = false;
        let startTransform = 0;
        let currentTransform = 0;
        let minSwipeDistance = 50;

        // Cache untuk menyimpan deskripsi yang sudah diambil dari Klik Indomaret
        let klikDescriptionCache = new Map();

        function cleanBarcode(barcode) {
            return String(barcode).replace(/\D/g, '');
        }

        // Fungsi untuk mengambil deskripsi dari Klik Indomaret
        async function getKlikIndomaretDescription(plu) {
            // Cek cache dulu
            if (klikDescriptionCache.has(plu)) {
                return klikDescriptionCache.get(plu);
            }

            try {
                const url = `https://www.klikindomaret.com/xpress/${plu}`;
                
                // Menggunakan service proxy untuk mengatasi CORS
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Parse HTML response
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                
                // Cari title dari berbagai sumber
                let title = null;
                
                // Method 1: Cari dalam script tag __NEXT_DATA__
                const scripts = doc.querySelectorAll('script');
                for (let script of scripts) {
                    if (script.textContent.includes('__NEXT_DATA__')) {
                        try {
                            const jsonMatch = script.textContent.match(/__NEXT_DATA__\s*=\s*({.*?});/);
                            if (jsonMatch) {
                                const nextData = JSON.parse(jsonMatch[1]);
                                title = nextData?.props?.pageProps?.title;
                                if (title) break;
                            }
                        } catch (e) {
                            console.log('Error parsing __NEXT_DATA__:', e);
                        }
                    }
                }
                
                // Method 2: Meta tag fallback
                if (!title) {
                    const metaTitle = doc.querySelector('meta[property="og:title"]');
                    if (metaTitle) {
                        title = metaTitle.getAttribute('content');
                    }
                }
                
                // Method 3: H1 fallback
                if (!title) {
                    const h1 = doc.querySelector('h1');
                    if (h1) {
                        title = h1.textContent.trim();
                    }
                }
                
                // Bersihkan title (hapus kode PLU dan "| Klik Indomaret")
                if (title) {
                    title = title
                        .replace(/ - \d{8}/, '') // Hapus " - 12345678"
                        .replace(/ \| Klik Indomaret/, '') // Hapus " | Klik Indomaret"
                        .trim();
                }
                
                // Cache hasil
                if (title) {
                    klikDescriptionCache.set(plu, title);
                }
                
                return title;
                
            } catch (error) {
                console.log(`Error fetching description for PLU ${plu}:`, error);
                return null;
            }
        }

        // Fungsi untuk update deskripsi secara batch
        async function updateDescriptionsFromKlik(results) {
            const updateStatus = document.getElementById('updateStatus');
            const updateBtn = document.querySelector('.update-btn');
            
            if (updateBtn) updateBtn.disabled = true;
            
            updateStatus.innerHTML = '<div style="background: #fff3cd; padding: 10px; border-radius: 5px; color: #856404; margin: 10px 0;">üîÑ Mengupdate deskripsi dari Klik Indomaret...</div>';
            
            for (let i = 0; i < results.length; i++) {
                const item = results[i];
                const plu = item.PLU || item.plu;
                
                if (plu) {
                    updateStatus.innerHTML = `<div style="background: #fff3cd; padding: 10px; border-radius: 5px; color: #856404; margin: 10px 0;">üì¶ [${i+1}/${results.length}] Getting description for PLU: ${plu}</div>`;
                    
                    const klikDescription = await getKlikIndomaretDescription(plu);
                    
                    if (klikDescription) {
                        console.log(`‚úÖ Updated PLU ${plu}: ${klikDescription}`);
                        
                        // Update tampilan
                        const descriptionCell = document.querySelector(`[data-plu="${plu}"] .description-cell`);
                        if (descriptionCell) {
                            descriptionCell.textContent = klikDescription;
                            descriptionCell.style.background = '#e7f5e7';
                            descriptionCell.innerHTML += '<div style="font-size: 0.8em; color: #666; font-style: italic; margin-top: 3px;">üìç Dari Klik Indomaret</div>';
                        }
                        
                        updateStatus.innerHTML = `<div style="background: #d4edda; padding: 10px; border-radius: 5px; color: #155724; margin: 10px 0;">‚úÖ Updated PLU ${plu}: ${klikDescription}</div>`;
                    } else {
                        console.log(`‚ùå No description found for PLU ${plu}`);
                        updateStatus.innerHTML = `<div style="background: #f8d7da; padding: 10px; border-radius: 5px; color: #721c24; margin: 10px 0;">‚ùå No description found for PLU ${plu}</div>`;
                    }
                    
                    // Delay untuk menghindari rate limiting
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            updateStatus.innerHTML = '<div style="background: #d4edda; padding: 10px; border-radius: 5px; color: #155724; margin: 10px 0;">‚úÖ Selesai update deskripsi dari Klik Indomaret</div>';
            if (updateBtn) updateBtn.disabled = false;
        }

        function getDescription(item) {
            // Jika ada deskripsi dari Klik Indomaret (sudah di-cache), gunakan itu
            const plu = item.PLU || item.plu;
            if (plu && klikDescriptionCache.has(plu)) {
                return klikDescriptionCache.get(plu);
            }
            
            // Fallback ke deskripsi dari Excel
            const descriptionKeys = [
                'DESKRIPSI', 'Deskripsi', 'deskripsi', 
                'DESCRIPTION', 'Description', 'description',
                'KETERANGAN', 'Keterangan', 'keterangan', 
                'NAMA', 'Nama', 'nama'
            ];

            for (let key of descriptionKeys) {
                if (item[key]) {
                    return item[key];
                }
            }

            return '-';
        }

        function getBarcodeValues(item) {
            const originalBarcode = item.BARCODE || item.Barcode || item.barcode || 
                                  String(item.PLU || item.plu);
            const cleanedBarcode = cleanBarcode(originalBarcode);
            
            return {
                original: originalBarcode,
                cleaned: cleanedBarcode || originalBarcode
            };
        }

        function getProductImageUrl(plu) {
            return `https://cdn-klik.klikindomaret.com/klik-catalog/product/${plu}_1.jpg`;
        }

        function createProductImage(plu, index) {
            const imageUrl = getProductImageUrl(plu);
            return `
                <img src="${imageUrl}" 
                     class="product-image" 
                     id="product-img-${index}"
                     onerror="handleImageError(this, ${index})"
                     onload="handleImageLoad(this)"
                     alt="Produk ${plu}">
                <div class="image-placeholder" id="placeholder-${index}" style="display: none;">
                    Gambar tidak tersedia
                </div>
            `;
        }

        function handleImageError(img, index) {
            img.style.display = 'none';
            const placeholder = document.getElementById(`placeholder-${index}`);
            if (placeholder) {
                placeholder.style.display = 'flex';
            }
        }

        function handleImageLoad(img) {
            img.style.opacity = '0';
            img.style.transition = 'opacity 0.3s ease';
            setTimeout(() => {
                img.style.opacity = '1';
            }, 100);
        }

        function updateDataStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('dataStatus');
            statusDiv.className = `data-status ${type}`;
            
            const icons = {
                loading: 'üîÑ',
                success: '‚úÖ',
                error: '‚ùå'
            };
            
            statusDiv.innerHTML = `${icons[type]} ${message}`;
        }

        function setInputEnabled(enabled) {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            searchInput.disabled = !enabled;
            searchBtn.disabled = !enabled;
            
            if (enabled) {
                searchInput.placeholder = "Masukkan kode PLU...\nSatu PLU per baris";
            } else {
                searchInput.placeholder = "Menunggu data dimuat...";
            }
        }

        async function loadExcelData() {
            setInputEnabled(false);
            
            try {
                const response = await fetch('data/data2.ods');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                if (jsonData.length === 0) {
                    throw new Error('File kosong atau tidak ada data yang valid');
                }
                
                excelData = jsonData;
                
                updateDataStatus(`Data berhasil dimuat! Total: ${excelData.length} item`, 'success');
                document.getElementById('dataStatus').style.display = 'block';
                setInputEnabled(true);
                
                document.getElementById('searchInput').focus();
                
            } catch (error) {
                console.error('Error loading Excel data:', error);
                
                const savedData = localStorage.getItem('excelData');
                if (savedData) {
                    excelData = JSON.parse(savedData);
                    const loadTime = localStorage.getItem('dataLoadTime');
                    const timeStr = loadTime ? new Date(loadTime).toLocaleString('id-ID') : 'Unknown';
                    
                    updateDataStatus(`‚ö†Ô∏è Menggunakan data backup (${excelData.length} item) - Dimuat: ${timeStr}`, 'error');
                    document.getElementById('dataStatus').style.display = 'block';
                    setInputEnabled(true);
                } else {
                    updateDataStatus(`‚ùå Gagal memuat data: ${error.message}`, 'error');
                    document.getElementById('dataStatus').style.display = 'block';
                    setInputEnabled(false);
                }
            }
        }

        window.addEventListener('load', function() {
            loadExcelData();
        });

        function searchMultiplePLU() {
            const searchText = document.getElementById('searchInput').value.trim();
            const resultDiv = document.getElementById('result');

            resultDiv.innerHTML = '<div class="loading">Sedang mencari data...</div>';

            if (!excelData.length) {
                resultDiv.innerHTML = '<div class="result-summary error">Data belum tersedia!</div>';
                return;
            }

            if (!searchText) {
                resultDiv.innerHTML = '<div class="result-summary error">Masukkan kode PLU!</div>';
                return;
            }

            const searchValues = searchText.split('\n').filter(line => line.trim());
            const results = [];
            const notFound = [];

            searchValues.forEach(searchValue => {
                searchValue = searchValue.trim();
                if (searchValue) {
                    const foundItem = excelData.find(item => {
                        return Object.values(item).some(value => 
                            String(value).toLowerCase() === searchValue.toLowerCase()
                        );
                    });

                    if (foundItem) {
                        results.push(foundItem);
                    } else {
                        notFound.push(searchValue);
                    }
                }
            });

            displayResults(results, notFound);
        }

        function displayResults(results, notFound) {
            const resultDiv = document.getElementById('result');
            const slideshowControls = document.getElementById('slideshowControls');
            
            stopSlideshow();
            
            let html = '';

            if (notFound.length > 0) {
                html += '<div class="result-summary">';
                html += `
                    <div class="error">
                        Tidak ditemukan (${notFound.length}): ${notFound.join(', ')}
                    </div>
                `;
                html += '</div>';
            }

            if (results.length > 0) {
                // Tambahkan tombol update deskripsi
                html += `
                    <div class="no-print" style="background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #007bff;">
                        <button onclick="updateDescriptionsFromKlik(slides)" class="update-btn" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; font-weight: bold;">
                            üîÑ Update Deskripsi dari Klik Indomaret
                        </button>
                        <div id="updateStatus"></div>
                    </div>
                `;
                
                if (results.length > 1) {
                    slideshowControls.classList.add('active');
                    html += '<div class="swipe-hint">üí° Geser kanan/kiri untuk ganti barcode</div>';
                } else {
                    slideshowControls.classList.remove('active');
                }

                html += '<div class="slideshow-container" id="slideshowContainer">';
                
                // Touch indicators
                html += '<div class="touch-indicator left" id="leftIndicator">‚Äπ</div>';
                html += '<div class="touch-indicator right" id="rightIndicator">‚Ä∫</div>';
                
                html += '<div class="slides-wrapper" id="slidesWrapper">';
                
                results.forEach((item, index) => {
                    const barcodeValues = getBarcodeValues(item);
                    const showOriginal = barcodeValues.original !== barcodeValues.cleaned;
                    const description = getDescription(item);
                    const plu = item.PLU || item.plu;
                    const isFromKlik = klikDescriptionCache.has(plu);
                    
                    html += `
                        <div class="barcode-item" data-slide="${index}" data-plu="${plu}">
                            ${createProductImage(plu, index)}
                            <table>
                                <tr>
                                    <th>PLU</th>
                                    <td>${plu || '-'}</td>
                                </tr>
                                <tr>
                                    <th>Barcode</th>
                                    <td>
                                        ${barcodeValues.cleaned}
                                        ${showOriginal ? 
                                            `<div class="original-barcode">(Original: ${barcodeValues.original})</div>` 
                                            : ''}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Deskripsi</th>
                                    <td class="description-cell" ${isFromKlik ? 'style="background: #e7f5e7;"' : ''}>
                                        ${description}
                                        ${isFromKlik ? '<div style="font-size: 0.8em; color: #666; font-style: italic; margin-top: 3px;">üìç Dari Klik Indomaret</div>' : ''}
                                    </td>
                                </tr>
                            </table>
                            <svg class="barcode-${barcodeValues.cleaned}-${index}"></svg>
                        </div>
                    `;
                });
                
                html += '</div></div>';
                
                slides = results;
                currentSlide = 0;
                updateSlideInfo();
            } else if (notFound.length === 0) {
                html += '<div class="result-summary error">Tidak ada PLU yang dicari!</div>';
                slideshowControls.classList.remove('active');
            } else {
                slideshowControls.classList.remove('active');
            }

            resultDiv.innerHTML = html;

            if (results.length > 0) {
                results.forEach((item, index) => {
                    const barcodeValues = getBarcodeValues(item);
                    try {
                        JsBarcode(`.barcode-${barcodeValues.cleaned}-${index}`, barcodeValues.cleaned, {
                            format: "CODE128",
                            width: 2,
                            height: 120,
                            displayValue: true
                        });
                    } catch (e) {
                        console.error('Error generating barcode:', e);
                    }
                });
                
                // Setup touch/swipe events
                setupTouchEvents();
                updateSlidePosition();
            }
        }

        function setupTouchEvents() {
            const container = document.getElementById('slideshowContainer');
            if (!container || slides.length <= 1) return;

            // Mouse events
            container.addEventListener('mousedown', handleStart, { passive: false });
            container.addEventListener('mousemove', handleMove, { passive: false });
            container.addEventListener('mouseup', handleEnd, { passive: false });
            container.addEventListener('mouseleave', handleEnd, { passive: false });

            // Touch events
            container.addEventListener('touchstart', handleStart, { passive: false });
            container.addEventListener('touchmove', handleMove, { passive: false });
            container.addEventListener('touchend', handleEnd, { passive: false });
            container.addEventListener('touchcancel', handleEnd, { passive: false });

            // Click event for simple tap navigation
            container.addEventListener('click', handleClick, { passive: true });

            // Prevent context menu and text selection
            container.addEventListener('contextmenu', e => e.preventDefault());
        }

        function handleStart(e) {
            if (slides.length <= 1) return;
            
            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            touchStartX = clientX;
            touchStartY = clientY;
            isDragging = false; // Will be set to true only for horizontal gestures
        }

        function handleMove(e) {
            if (slides.length <= 1) return;
            
            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            const deltaX = clientX - touchStartX;
            const deltaY = clientY - touchStartY;
            
            // Determine if this is a horizontal or vertical gesture
            if (!isDragging) {
                const absDeltaX = Math.abs(deltaX);
                const absDeltaY = Math.abs(deltaY);
                
                // If movement is more vertical than horizontal, allow normal scroll
                if (absDeltaY > absDeltaX && absDeltaY > 10) {
                    return; // Let browser handle vertical scroll
                }
                
                // If movement is more horizontal, start horizontal sliding
                if (absDeltaX > absDeltaY && absDeltaX > 10) {
                    isDragging = true;
                    e.preventDefault();
                    
                    const slidesWrapper = document.getElementById('slidesWrapper');
                    slidesWrapper.classList.add('no-transition');
                    
                    // Stop slideshow when user starts horizontal swiping
                    if (isSlideshow) {
                        stopSlideshow();
                    }
                }
                
                return;
            }
            
            // Now we're in horizontal sliding mode
            e.preventDefault();
            
            const slidesWrapper = document.getElementById('slidesWrapper');
            const baseTransform = -currentSlide * 100;
            const dragPercent = (deltaX / window.innerWidth) * 100;
            
            currentTransform = baseTransform + dragPercent;
            slidesWrapper.style.transform = `translateX(${currentTransform}%)`;
        }

        function handleEnd(e) {
            if (!isDragging || slides.length <= 1) return;
            
            isDragging = false;
            
            const clientX = e.type.includes('mouse') ? e.clientX : (e.changedTouches ? e.changedTouches[0].clientX : touchStartX);
            
            touchEndX = clientX;
            const deltaX = touchEndX - touchStartX;
            
            const slidesWrapper = document.getElementById('slidesWrapper');
            slidesWrapper.classList.remove('no-transition');
            
            // Determine if swipe is significant enough
            if (Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0) {
                    // Swipe right - go to previous slide
                    prevSlide();
                } else {
                    // Swipe left - go to next slide
                    nextSlide();
                }
            } else {
                // Snap back to current slide
                updateSlidePosition();
            }
        }

        function handleClick(e) {
            if (slides.length <= 1) return;
            
            // Only handle click if there was no significant drag movement
            const totalMovement = Math.abs(touchEndX - touchStartX);
            if (totalMovement > 10) return; // Ignore clicks after drag
            
            const container = document.getElementById('slideshowContainer');
            const rect = container.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const containerWidth = rect.width;
            
            // Divide container into thirds: left, center, right
            if (clickX < containerWidth / 3) {
                // Click on left third - previous slide
                prevSlide();
            } else if (clickX > (containerWidth * 2) / 3) {
                // Click on right third - next slide
                nextSlide();
            }
            // Middle third does nothing (or could pause/play slideshow)
        }

        function updateSlidePosition() {
            const slidesWrapper = document.getElementById('slidesWrapper');
            if (!slidesWrapper) return;
            
            if (animationType === 'slide') {
                const translateX = -currentSlide * 100;
                slidesWrapper.style.transform = `translateX(${translateX}%)`;
                slidesWrapper.style.opacity = '1';
            } else if (animationType === 'fade') {
                const items = document.querySelectorAll('.barcode-item');
                items.forEach((item, index) => {
                    if (index === currentSlide) {
                        item.style.display = 'block';
                        item.style.opacity = '1';
                    } else {
                        item.style.display = 'none';
                        item.style.opacity = '0';
                    }
                });
                slidesWrapper.style.transform = 'translateX(0%)';
            }
        }

        function updateAnimationType() {
            animationType = document.getElementById('animationType').value;
            const slidesWrapper = document.getElementById('slidesWrapper');
            if (!slidesWrapper) return;
            
            if (animationType === 'slide') {
                const items = document.querySelectorAll('.barcode-item');
                items.forEach(item => {
                    item.style.display = 'block';
                    item.style.opacity = '1';
                });
            }
            
            updateSlidePosition();
        }

        function toggleSlideshow() {
            if (isSlideshow) {
                stopSlideshow();
            } else {
                startSlideshow();
            }
        }

        function startSlideshow() {
            if (slides.length <= 1) return;
            
            isSlideshow = true;
            document.getElementById('slideshowBtn').textContent = 'Stop Slideshow';
            
            slideshowInterval = setInterval(() => {
                nextSlide();
            }, slideTime);
        }

        function stopSlideshow() {
            isSlideshow = false;
            document.getElementById('slideshowBtn').textContent = 'Mulai Slideshow';
            
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
            }
        }

        function nextSlide() {
            if (slides.length <= 1 || isAnimating) return;
            
            isAnimating = true;
            currentSlide = (currentSlide + 1) % slides.length;
            updateSlidePosition();
            updateSlideInfo();
            
            setTimeout(() => {
                isAnimating = false;
            }, 600);
        }

        function prevSlide() {
            if (slides.length <= 1 || isAnimating) return;
            
            isAnimating = true;
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            updateSlidePosition();
            updateSlideInfo();
            
            setTimeout(() => {
                isAnimating = false;
            }, 600);
        }

        function updateSlideInfo() {
            const slideInfo = document.getElementById('slideInfo');
            if (slideInfo && slides.length > 0) {
                slideInfo.textContent = `Slide ${currentSlide + 1} dari ${slides.length}`;
            }
        }

        function updateSlideTime() {
            slideTime = parseInt(document.getElementById('slideTime').value);
            if (isSlideshow) {
                stopSlideshow();
                startSlideshow();
            }
        }

        function clearResults() {
            stopSlideshow();
            document.getElementById('result').innerHTML = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('slideshowControls').classList.remove('active');
            slides = [];
            currentSlide = 0;
            isAnimating = false;
        }

        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                searchMultiplePLU();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                loadExcelData();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const menuItems = document.querySelectorAll('.menu-item');
                menuItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.textContent.includes('PLU Barcode Generator')) {
                        item.classList.add('active');
                    }
                });
            }, 100);
        });

        // Tambahan untuk handle update button style hover
        document.addEventListener('mouseover', function(e) {
            if (e.target.classList.contains('update-btn') && !e.target.disabled) {
                e.target.style.background = 'linear-gradient(135deg, #0056b3, #004085)';
            }
        });

        document.addEventListener('mouseout', function(e) {
            if (e.target.classList.contains('update-btn') && !e.target.disabled) {
                e.target.style.background = 'linear-gradient(135deg, #007bff, #0056b3)';
            }
        });
    </script>
</body>
</html>